<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Hotel Financial Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 50%, #1e40af 100%);
            min-height: 100vh;
            padding: 20px;
            color: #1f2937;
        }

        .dashboard {
            max-width: 1600px;
            margin: 0 auto;
            background: #ffffff;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .kpi-tabs {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .tab-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .tab-btn.active {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .panel {
            background: #ffffff;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            border: 1px solid #e5e7eb;
            transition: all 0.3s ease;
        }

        .panel:hover {
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f3f4f6;
        }

        .panel-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .add-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: background 0.3s ease;
        }

        .add-btn:hover {
            background: #2563eb;
        }

        .input-section {
            margin-bottom: 20px;
        }

        .section-label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: #6b7280;
            margin-bottom: 6px;
        }

        .input-field {
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            background: #ffffff;
        }

        .input-field:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .number-input {
            text-align: right;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
        }

        .dynamic-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .dynamic-row:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }

        .dynamic-row input:first-child {
            flex: 2;
            min-width: 0;
        }

        .dynamic-row input:nth-child(2) {
            flex: 1;
            min-width: 120px;
        }

        .currency-label {
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 500;
            min-width: 35px;
        }

        .remove-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: background 0.3s ease;
            white-space: nowrap;
        }

        .remove-btn:hover {
            background: #dc2626;
        }

        .analytics-panel {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
            color: white;
        }

        .analytics-panel .panel-title {
            color: white;
        }

        .analytics-panel .panel-header {
            border-bottom-color: rgba(255, 255, 255, 0.2);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .metric-primary {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border: none;
        }

        .metric-label {
            font-size: 0.875rem;
            opacity: 0.8;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
        }

        .metric-subtitle {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 4px;
        }

        .warning-panel {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #f59e0b;
            background: rgba(251, 191, 36, 0.1);
            color: #92400e;
            font-weight: 500;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .kpi-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .kpi-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
        }

        .kpi-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        @media (max-width: 1200px) {
            .content-grid {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .dynamic-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .dynamic-row input {
                margin-bottom: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <div class="header-content">
                <h1>üè® Hotel Financial Analytics Dashboard</h1>
                <p>Professional Hotel Revenue Management & Breakeven Analysis</p>
                
                <div class="kpi-tabs">
                    <button class="tab-btn active" onclick="showKPITab('revenue')">Revenue KPIs</button>
                    <button class="tab-btn" onclick="showKPITab('operational')">Operational KPIs</button>
                    <button class="tab-btn" onclick="showKPITab('financial')">Financial KPIs</button>
                    <button class="tab-btn" onclick="clearData()" style="background: rgba(239, 68, 68, 0.2); border-color: rgba(239, 68, 68, 0.4);">üîÑ Reset Data</button>
                </div>

                <div id="revenue-tab" class="tab-content active">
                    <div class="kpi-card">
                        <div class="kpi-value" id="adr-kpi">‡∏ø0</div>
                        <div class="kpi-label">ADR (Average Daily Rate)</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value" id="revpar-kpi">‡∏ø0</div>
                        <div class="kpi-label">RevPAR (Revenue per Available Room)</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value" id="trevpar-kpi">‡∏ø0</div>
                        <div class="kpi-label">TRevPAR (Total Revenue per Available Room)</div>
                    </div>
                </div>

                <div id="operational-tab" class="tab-content">
                    <div class="kpi-card">
                        <div class="kpi-value" id="occupancy-kpi">0%</div>
                        <div class="kpi-label">Occupancy Rate</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value" id="lpar-kpi">‡∏ø0</div>
                        <div class="kpi-label">LPAR (Labor per Available Room)</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value" id="cpor-kpi">‡∏ø0</div>
                        <div class="kpi-label">CPOR (Cost per Occupied Room)</div>
                    </div>
                </div>

                <div id="financial-tab" class="tab-content">
                    <div class="kpi-card">
                        <div class="kpi-value" id="goppar-kpi">‡∏ø0</div>
                        <div class="kpi-label">GOPPAR (GOP per Available Room)</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value" id="gop-margin-kpi">0%</div>
                        <div class="kpi-label">GOP Margin</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-value" id="profpar-kpi">‡∏ø0</div>
                        <div class="kpi-label">PROFPAR (Profit per Available Room)</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="content-grid">
            <!-- Hotel Configuration Panel -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">üè® Hotel Configuration</div>
                </div>
                
                <div class="input-section">
                    <div class="section-label">Property Details</div>
                    <div class="input-grid">
                        <div class="input-group">
                            <label class="input-label">Total Rooms</label>
                            <input type="text" class="input-field number-input" id="totalRooms" placeholder="100">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Average Daily Rate (ADR)</label>
                            <input type="text" class="input-field number-input" id="adr" placeholder="3,500">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Target Occupancy (%)</label>
                            <input type="text" class="input-field number-input" id="targetOccupancy" placeholder="75">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Commission/OTA Fees (%)</label>
                            <input type="text" class="input-field number-input" id="commission" placeholder="15">
                        </div>
                    </div>
                </div>

                <div class="input-section">
                    <div class="section-label">Variable Costs per Occupied Room</div>
                    <div class="input-grid">
                        <div class="input-group">
                            <label class="input-label">Housekeeping & Supplies</label>
                            <input type="text" class="input-field number-input" id="housekeepingCost" placeholder="400">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Utilities per Room</label>
                            <input type="text" class="input-field number-input" id="utilitiesPerRoom" placeholder="200">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Amenities & Linens</label>
                            <input type="text" class="input-field number-input" id="amenitiesCost" placeholder="150">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Other Variable Costs</label>
                            <input type="text" class="input-field number-input" id="otherVariableCosts" placeholder="100">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Fixed Operating Costs Panel -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">üí∞ Fixed Operating Costs</div>
                    <button class="add-btn" onclick="addFixedCost()">+ Add Cost</button>
                </div>
                <div id="fixedCosts"></div>
            </div>

            <!-- Revenue Streams Panel -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">üìä Revenue Streams</div>
                    <button class="add-btn" onclick="addRevenue()">+ Add Stream</button>
                </div>
                <div id="revenues"></div>
            </div>

            <!-- Labor Costs Panel -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">üë• Labor Costs</div>
                    <button class="add-btn" onclick="addLaborCost()">+ Add Position</button>
                </div>
                <div id="laborCosts"></div>
            </div>

            <!-- Financial Analytics Panel -->
            <div class="panel analytics-panel">
                <div class="panel-header">
                    <div class="panel-title">üìà Financial Performance Analysis</div>
                </div>
                
                <div class="metrics-grid">
                    <div class="metric-card metric-primary">
                        <div class="metric-label">Breakeven Occupancy</div>
                        <div class="metric-value" id="breakevenOccupancy">0%</div>
                        <div class="metric-subtitle">Required to break even</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-label">Monthly Revenue Needed</div>
                        <div class="metric-value" id="revenueNeeded">‡∏ø0</div>
                        <div class="metric-subtitle">To achieve breakeven</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-label">GOP (Gross Operating Profit)</div>
                        <div class="metric-value" id="gop">‡∏ø0</div>
                        <div class="metric-subtitle">At target occupancy</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-label">Contribution Margin</div>
                        <div class="metric-value" id="contributionMargin">‡∏ø0</div>
                        <div class="metric-subtitle">Per occupied room</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-label">Total Fixed Costs</div>
                        <div class="metric-value" id="totalFixedCosts">‡∏ø0</div>
                        <div class="metric-subtitle">Monthly operating expenses</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-label">Safety Margin Target</div>
                        <div class="metric-value" id="safetyMargin">‡∏ø0</div>
                        <div class="metric-subtitle">20% above breakeven</div>
                    </div>
                </div>

                <div id="warningMessage"></div>
            </div>
        </div>
    </div>

    <script>
        // Industry standard default data based on research
        const defaultFixedCosts = [
            { name: 'Property Rent/Mortgage', value: 800000 },
            { name: 'Staff Salaries (Fixed)', value: 1200000 },
            { name: 'Property Insurance', value: 150000 },
            { name: 'Property Taxes', value: 200000 },
            { name: 'Base Utilities', value: 180000 },
            { name: 'Marketing & Advertising', value: 250000 },
            { name: 'Maintenance Contracts', value: 120000 },
            { name: 'Administrative Expenses', value: 180000 },
            { name: 'Technology & Software', value: 80000 },
            { name: 'Professional Services', value: 100000 }
        ];

        const defaultRevenues = [
            { name: 'Food & Beverage', value: 2500000, margin: 25 },
            { name: 'Spa & Wellness Services', value: 800000, margin: 60 },
            { name: 'Event & Conference Spaces', value: 1200000, margin: 40 },
            { name: 'Parking Services', value: 300000, margin: 80 },
            { name: 'Laundry Services', value: 200000, margin: 35 },
            { name: 'Business Center', value: 150000, margin: 70 },
            { name: 'Retail & Gift Shop', value: 250000, margin: 50 },
            { name: 'Tour & Excursion Services', value: 400000, margin: 30 }
        ];

        const defaultLaborCosts = [
            { name: 'Front Office Staff', value: 450000 },
            { name: 'Housekeeping', value: 600000 },
            { name: 'Food & Beverage Staff', value: 800000 },
            { name: 'Maintenance Staff', value: 300000 },
            { name: 'Security', value: 250000 },
            { name: 'Management', value: 500000 },
            { name: 'Spa & Wellness Staff', value: 200000 },
            { name: 'Event Coordination', value: 180000 }
        ];

        // Initialize dashboard
        function init() {
            const savedData = loadData();
            
            if (savedData) {
                loadSavedData(savedData);
            } else {
                setDefaults();
            }
            
            calculate();
        }

        function setDefaults() {
            // Set property defaults
            document.getElementById('totalRooms').value = '120';
            document.getElementById('adr').value = '3,500';
            document.getElementById('targetOccupancy').value = '75';
            document.getElementById('commission').value = '15';
            document.getElementById('housekeepingCost').value = '400';
            document.getElementById('utilitiesPerRoom').value = '200';
            document.getElementById('amenitiesCost').value = '150';
            document.getElementById('otherVariableCosts').value = '100';

            // Add default costs and revenues
            defaultFixedCosts.forEach(cost => addFixedCost(cost.name, formatNumber(cost.value)));
            defaultRevenues.forEach(rev => addRevenue(rev.name, formatNumber(rev.value), rev.margin));
            defaultLaborCosts.forEach(labor => addLaborCost(labor.name, formatNumber(labor.value)));
        }

        function loadSavedData(data) {
            // Load property settings
            Object.keys(data.property || {}).forEach(key => {
                const element = document.getElementById(key);
                if (element) element.value = data.property[key];
            });

            // Load dynamic costs
            (data.fixedCosts || []).forEach(cost => addFixedCost(cost.name, cost.value));
            (data.revenues || []).forEach(rev => addRevenue(rev.name, rev.value, rev.margin));
            (data.laborCosts || []).forEach(labor => addLaborCost(labor.name, labor.value));
        }

        // Dynamic row functions
        function addFixedCost(name = '', value = '') {
            const container = document.getElementById('fixedCosts');
            const row = document.createElement('div');
            row.className = 'dynamic-row';
            row.innerHTML = `
                <input type="text" class="input-field" placeholder="Cost category (e.g., Insurance)" value="${name}">
                <input type="text" class="input-field number-input" placeholder="0" value="${value}" oninput="handleNumberInput(this)">
                <span class="currency-label">THB</span>
                <button class="remove-btn" onclick="removeRow(this)">Remove</button>
            `;
            container.appendChild(row);
            saveData();
        }

        function addRevenue(name = '', value = '', margin = '') {
            const container = document.getElementById('revenues');
            const row = document.createElement('div');
            row.className = 'dynamic-row';
            row.innerHTML = `
                <input type="text" class="input-field" placeholder="Revenue stream (e.g., F&B)" value="${name}">
                <input type="text" class="input-field number-input" placeholder="0" value="${value}" oninput="handleNumberInput(this)">
                <input type="text" class="input-field number-input" placeholder="30" value="${margin}" oninput="handleNumberInput(this)" style="max-width: 80px;">
                <span class="currency-label">THB</span>
                <span class="currency-label">%</span>
                <button class="remove-btn" onclick="removeRow(this)">Remove</button>
            `;
            container.appendChild(row);
            saveData();
        }

        function addLaborCost(name = '', value = '') {
            const container = document.getElementById('laborCosts');
            const row = document.createElement('div');
            row.className = 'dynamic-row';
            row.innerHTML = `
                <input type="text" class="input-field" placeholder="Position/Department" value="${name}">
                <input type="text" class="input-field number-input" placeholder="0" value="${value}" oninput="handleNumberInput(this)">
                <span class="currency-label">THB</span>
                <button class="remove-btn" onclick="removeRow(this)">Remove</button>
            `;
            container.appendChild(row);
            saveData();
        }

        function removeRow(button) {
            button.closest('.dynamic-row').remove();
            saveData();
            calculate();
        }

        // Number formatting
        function handleNumberInput(input) {
            let value = input.value.replace(/[^\d.]/g, '');
            let parts = value.split('.');
            if (parts.length > 2) {
                value = parts[0] + '.' + parts.slice(1).join('');
            }
            if (parts[0]) {
                parts[0] = parseInt(parts[0]).toLocaleString('en-US');
            }
            input.value = parts.join('.');
            calculate();
            saveData();
        }

        function parseNumber(value) {
            return parseFloat(value.replace(/,/g, '')) || 0;
        }

        function formatNumber(value) {
            if (!value) return '';
            const num = parseFloat(value);
            return isNaN(num) ? '' : num.toLocaleString('en-US');
        }

        // KPI Tab functionality
        function showKPITab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // Main calculation function
        function calculate() {
            // Get property values
            const totalRooms = parseNumber(document.getElementById('totalRooms').value) || 120;
            const adr = parseNumber(document.getElementById('adr').value) || 3500;
            const targetOccupancy = parseNumber(document.getElementById('targetOccupancy').value) || 75;
            const commission = parseNumber(document.getElementById('commission').value) || 15;
            
            // Variable costs per room
            const housekeeping = parseNumber(document.getElementById('housekeepingCost').value) || 0;
            const utilities = parseNumber(document.getElementById('utilitiesPerRoom').value) || 0;
            const amenities = parseNumber(document.getElementById('amenitiesCost').value) || 0;
            const otherVariable = parseNumber(document.getElementById('otherVariableCosts').value) || 0;
            const totalVariableCostPerRoom = housekeeping + utilities + amenities + otherVariable;

            // Calculate fixed costs
            let totalFixedCosts = 0;
            document.querySelectorAll('#fixedCosts .dynamic-row').forEach(row => {
                const inputs = row.querySelectorAll('.number-input');
                if (inputs.length > 0) {
                    totalFixedCosts += parseNumber(inputs[0].value);
                }
            });

            // Calculate labor costs
            let totalLaborCosts = 0;
            document.querySelectorAll('#laborCosts .dynamic-row').forEach(row => {
                const inputs = row.querySelectorAll('.number-input');
                if (inputs.length > 0) {
                    totalLaborCosts += parseNumber(inputs[0].value);
                }
            });

            // Calculate ancillary revenue
            let totalAncillaryRevenue = 0;
            let totalAncillaryProfit = 0;
            document.querySelectorAll('#revenues .dynamic-row').forEach(row => {
                const inputs = row.querySelectorAll('.number-input');
                if (inputs.length >= 2) {
                    const revenue = parseNumber(inputs[0].value);
                    const margin = parseNumber(inputs[1].value) || 30;
                    totalAncillaryRevenue += revenue;
                    totalAncillaryProfit += revenue * (margin / 100);
                }
            });

            // Core calculations
            const totalMonthlyFixedCosts = totalFixedCosts + totalLaborCosts;
            const effectiveADR = adr * (1 - commission / 100);
            const contributionMarginPerRoom = effectiveADR - totalVariableCostPerRoom;
            
            // Net fixed costs after ancillary profit
            const netFixedCosts = Math.max(0, totalMonthlyFixedCosts - totalAncillaryProfit);
            
            // Breakeven calculations
            const breakevenRoomsPerMonth = contributionMarginPerRoom > 0 ? Math.ceil(netFixedCosts / contributionMarginPerRoom) : 0;
            const maxRoomsPerMonth = totalRooms * 30;
            const breakevenOccupancyRate = maxRoomsPerMonth > 0 ? (breakevenRoomsPerMonth / maxRoomsPerMonth) * 100 : 0;
            
            // Revenue calculations
            const monthlyRoomRevenue = (totalRooms * 30 * (targetOccupancy / 100)) * effectiveADR;
            const totalMonthlyRevenue = monthlyRoomRevenue + totalAncillaryRevenue;
            const breakevenRevenue = breakevenRoomsPerMonth * effectiveADR + totalAncillaryRevenue;
            
            // Profitability calculations
            const monthlyVariableCosts = (totalRooms * 30 * (targetOccupancy / 100)) * totalVariableCostPerRoom;
            const monthlyAncillaryCosts = totalAncillaryRevenue - totalAncillaryProfit;
            const totalMonthlyCosts = totalMonthlyFixedCosts + monthlyVariableCosts + monthlyAncillaryCosts;
            const gop = totalMonthlyRevenue - totalMonthlyCosts;
            const gopMargin = totalMonthlyRevenue > 0 ? (gop / totalMonthlyRevenue) * 100 : 0;
            
            // Industry KPIs
            const revpar = (totalRooms * 30) > 0 ? monthlyRoomRevenue / (totalRooms * 30) : 0;
            const trevpar = (totalRooms * 30) > 0 ? totalMonthlyRevenue / (totalRooms * 30) : 0;
            const goppar = (totalRooms * 30) > 0 ? gop / (totalRooms * 30) : 0;
            const lpar = (totalRooms * 30) > 0 ? totalLaborCosts / (totalRooms * 30) : 0;
            const cpor = (targetOccupancy > 0) ? (totalMonthlyCosts / (totalRooms * 30 * (targetOccupancy / 100))) : 0;
            const profpar = goppar; // Same as GOPPAR for simplicity
            
            // Update main analytics
            document.getElementById('breakevenOccupancy').textContent = `${breakevenOccupancyRate.toFixed(1)}%`;
            document.getElementById('revenueNeeded').textContent = `‡∏ø${breakevenRevenue.toLocaleString()}`;
            document.getElementById('gop').textContent = `‡∏ø${gop.toLocaleString()}`;
            document.getElementById('contributionMargin').textContent = `‡∏ø${contributionMarginPerRoom.toLocaleString()}`;
            document.getElementById('totalFixedCosts').textContent = `‡∏ø${totalMonthlyFixedCosts.toLocaleString()}`;
            document.getElementById('safetyMargin').textContent = `‡∏ø${(breakevenRevenue * 1.2).toLocaleString()}`;

            // Update KPI tabs
            document.getElementById('adr-kpi').textContent = `‡∏ø${effectiveADR.toLocaleString()}`;
            document.getElementById('revpar-kpi').textContent = `‡∏ø${revpar.toLocaleString()}`;
            document.getElementById('trevpar-kpi').textContent = `‡∏ø${trevpar.toLocaleString()}`;
            document.getElementById('occupancy-kpi').textContent = `${targetOccupancy}%`;
            document.getElementById('lpar-kpi').textContent = `‡∏ø${lpar.toLocaleString()}`;
            document.getElementById('cpor-kpi').textContent = `‡∏ø${cpor.toLocaleString()}`;
            document.getElementById('goppar-kpi').textContent = `‡∏ø${goppar.toLocaleString()}`;
            document.getElementById('gop-margin-kpi').textContent = `${gopMargin.toFixed(1)}%`;
            document.getElementById('profpar-kpi').textContent = `‡∏ø${profpar.toLocaleString()}`;

            // Warning messages
            const warningDiv = document.getElementById('warningMessage');
            warningDiv.innerHTML = '';
            
            if (breakevenOccupancyRate > 100) {
                warningDiv.innerHTML = '<div class="warning-panel">‚ö†Ô∏è Critical: Required occupancy exceeds 100%! Consider reducing costs or increasing ADR.</div>';
            } else if (breakevenOccupancyRate > 85) {
                warningDiv.innerHTML = '<div class="warning-panel">‚ö†Ô∏è High Risk: Breakeven requires >85% occupancy. Consider optimizing cost structure.</div>';
            } else if (gop < 0) {
                warningDiv.innerHTML = '<div class="warning-panel">‚ùå Loss Making: Current projections show negative GOP. Immediate action required.</div>';
            } else if (breakevenOccupancyRate < 50 && gop > 0) {
                warningDiv.innerHTML = '<div class="warning-panel" style="border-color: #10b981; background: rgba(16, 185, 129, 0.1); color: #047857;">‚úÖ Excellent: Strong financial position with healthy profit margins.</div>';
            }
        }

        // Data persistence with localStorage
        function saveData() {
            const data = {
                property: {
                    totalRooms: document.getElementById('totalRooms').value,
                    adr: document.getElementById('adr').value,
                    targetOccupancy: document.getElementById('targetOccupancy').value,
                    commission: document.getElementById('commission').value,
                    housekeepingCost: document.getElementById('housekeepingCost').value,
                    utilitiesPerRoom: document.getElementById('utilitiesPerRoom').value,
                    amenitiesCost: document.getElementById('amenitiesCost').value,
                    otherVariableCosts: document.getElementById('otherVariableCosts').value
                },
                fixedCosts: [],
                revenues: [],
                laborCosts: [],
                lastUpdated: new Date().toISOString()
            };

            // Save dynamic data
            document.querySelectorAll('#fixedCosts .dynamic-row').forEach(row => {
                const inputs = row.querySelectorAll('input');
                if (inputs.length >= 2) {
                    data.fixedCosts.push({
                        name: inputs[0].value,
                        value: inputs[1].value
                    });
                }
            });

            document.querySelectorAll('#revenues .dynamic-row').forEach(row => {
                const inputs = row.querySelectorAll('input');
                if (inputs.length >= 3) {
                    data.revenues.push({
                        name: inputs[0].value,
                        value: inputs[1].value,
                        margin: inputs[2].value
                    });
                }
            });

            document.querySelectorAll('#laborCosts .dynamic-row').forEach(row => {
                const inputs = row.querySelectorAll('input');
                if (inputs.length >= 2) {
                    data.laborCosts.push({
                        name: inputs[0].value,
                        value: inputs[1].value
                    });
                }
            });

            // Save to localStorage
            try {
                localStorage.setItem('hotelDashboardData', JSON.stringify(data));
            } catch (e) {
                console.warn('localStorage not available, using session storage');
                window.hotelData = data;
            }
        }

        function loadData() {
            try {
                const saved = localStorage.getItem('hotelDashboardData');
                return saved ? JSON.parse(saved) : null;
            } catch (e) {
                console.warn('localStorage not available, using session storage');
                return window.hotelData || null;
            }
        }

        function clearData() {
            try {
                localStorage.removeItem('hotelDashboardData');
            } catch (e) {
                window.hotelData = null;
            }
            location.reload();
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', init);
        
        // Add event listeners for property inputs
        ['totalRooms', 'adr', 'targetOccupancy', 'commission', 'housekeepingCost', 'utilitiesPerRoom', 'amenitiesCost', 'otherVariableCosts'].forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener('input', function() { 
                    handleNumberInput(this); 
                });
                element.addEventListener('blur', saveData);
            }
        });
    </script>
</body>
</html>
