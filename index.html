<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hotel Financial Tracker</title>
  <!-- original style preserved here -->
</head>
<body>
  <!-- original HTML content preserved here -->

  <script>
    let appData = JSON.parse(localStorage.getItem('hotelAppData')) || {
      entries: [],
      breakevenTarget: 5000
    };

    function saveToLocal() {
      localStorage.setItem('hotelAppData', JSON.stringify(appData));
    }

    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
      document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
      const button = event.currentTarget || event.target;
      if (button.classList.contains('nav-link')) {
        button.classList.add('active');
      }
      if (pageId === 'dashboard') updateDashboard();
      if (pageId === 'reports') updateReports();
    }

    function updateDashboard() {
      const currentMonth = new Date().toISOString().slice(0, 7);
      const monthlyEntries = appData.entries.filter(e => e.date.startsWith(currentMonth));
      const totalRevenue = monthlyEntries.filter(e => e.type === 'revenue').reduce((sum, e) => sum + e.total, 0);
      const totalExpenses = monthlyEntries.filter(e => e.type === 'expense').reduce((sum, e) => sum + e.total, 0);
      const netProfit = totalRevenue - totalExpenses;
      const latestRevenue = [...monthlyEntries].reverse().find(e => e.type === 'revenue' && e.occupancy);
      const occupancyRate = latestRevenue ? latestRevenue.occupancy : 0;

      document.getElementById('total-revenue').textContent = totalRevenue.toFixed(2);
      document.getElementById('total-expenses').textContent = totalExpenses.toFixed(2);
      const netEl = document.getElementById('net-profit');
      netEl.textContent = `฿${netProfit.toFixed(2)}`;
      netEl.className = `card-value ${netProfit >= 0 ? 'profit-positive' : 'profit-negative'}`;
      document.getElementById('occupancy-rate').textContent = occupancyRate.toFixed(1);

      const message = document.getElementById('breakeven-message');
      if (netProfit >= appData.breakevenTarget) {
        message.textContent = `🎉 You're ฿${(netProfit - appData.breakevenTarget).toFixed(2)} above breakeven!`;
        message.className = 'breakeven-message breakeven-success';
        message.style.display = 'block';
      } else if (totalRevenue > 0) {
        const shortfall = appData.breakevenTarget - netProfit;
        message.textContent = `⚠️ Need ฿${shortfall.toFixed(2)} more to breakeven.`;
        message.className = 'breakeven-message breakeven-warning';
        message.style.display = 'block';
      } else {
        message.style.display = 'none';
      }
    }

    document.getElementById('revenue-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const date = document.getElementById('revenue-date').value;
      const agoda = parseFloat(document.getElementById('revenue-agoda').value) || 0;
      const booking = parseFloat(document.getElementById('revenue-booking').value) || 0;
      const walkin = parseFloat(document.getElementById('revenue-walkin').value) || 0;
      const other = parseFloat(document.getElementById('revenue-other').value) || 0;
      const occupancy = parseFloat(document.getElementById('occupancy-input').value) || 0;
      const notes = document.getElementById('revenue-notes').value;
      const totalRevenue = agoda + booking + walkin + other;
      if (totalRevenue > 0) {
        appData.entries.push({ id: Date.now(), date, type: 'revenue', sources: { agoda, booking, walkin, other }, total: totalRevenue, occupancy, notes });
        alert('Revenue saved.');
        this.reset();
        setDefaultDates();
        updateDashboard();
        saveToLocal();
      }
    });

    document.getElementById('expense-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const date = document.getElementById('expense-date').value;
      const fixedCosts = [...document.querySelectorAll('#fixed-costs .cost-item')].map(item => ({
        name: item.querySelector('[name="fixed-name"]').value,
        amount: parseFloat(item.querySelector('[name="fixed-amount"]').value) || 0
      })).filter(c => c.name && c.amount > 0);

      const variableCosts = [...document.querySelectorAll('#variable-costs .cost-item')].map(item => ({
        name: item.querySelector('[name="variable-name"]').value,
        amount: parseFloat(item.querySelector('[name="variable-amount"]').value) || 0
      })).filter(c => c.name && c.amount > 0);

      const totalExpenses = [...fixedCosts, ...variableCosts].reduce((sum, c) => sum + c.amount, 0);
      if (totalExpenses > 0) {
        appData.entries.push({ id: Date.now(), date, type: 'expense', fixedCosts, variableCosts, total: totalExpenses });
        alert('Expense saved.');
        this.reset();
        setDefaultDates();
        addFixedCost();
        addVariableCost();
        updateDashboard();
        saveToLocal();
      }
    });

    window.addEventListener('load', function () {
      setDefaultDates();
      updateDashboard();
      updateReports();
      document.getElementById('report-month').value = new Date().toISOString().slice(0, 7);
    });
  </script>
</body>
</html>
